<!DOCTYPE html>
<html>
<head>
    <title>Test React Query with Supabase</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@tanstack/react-query@5/build/modern/react-query.umd.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { useQuery, QueryClient, QueryClientProvider } = ReactQuery;
        
        // Supabase client
        const supabase = supabase.createClient(
            'https://lkhqdqlryjzalsemofdt.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxraHFkcWxyeWp6YWxzZW1vZmR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MjgzOTcsImV4cCI6MjA3MDQwNDM5N30.uyaSNaaUf_hEx6RSqND6a9Unb_IvHKmV6tOLsGFcITc'
        );
        
        const queryClient = new QueryClient({
            defaultOptions: {
                queries: {
                    staleTime: 0,
                    gcTime: 0,
                }
            }
        });
        
        function CustomersList() {
            const { data: customers = [], isLoading, error } = useQuery({
                queryKey: ['customers'],
                queryFn: async () => {
                    console.log('üî• Fetching customers...');
                    const { data, error } = await supabase
                        .from('customers')
                        .select('*')
                        .eq('user_id', '11111111-1111-1111-1111-111111111111');
                    
                    if (error) {
                        console.error('‚ùå Error:', error);
                        throw error;
                    }
                    
                    console.log('‚úÖ Got customers:', data?.length, data);
                    return data;
                },
                staleTime: 0,
                gcTime: 0,
            });
            
            if (isLoading) return <div>Loading...</div>;
            if (error) return <div>Error: {error.message}</div>;
            
            return (
                <div>
                    <h1>Customers ({customers.length})</h1>
                    <ul>
                        {customers.map(customer => (
                            <li key={customer.id}>{customer.name} - {customer.phone_number}</li>
                        ))}
                    </ul>
                </div>
            );
        }
        
        function App() {
            return (
                <QueryClientProvider client={queryClient}>
                    <CustomersList />
                </QueryClientProvider>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>